# Note that this is NOT a relocatable package
%define ver     @SPEC_VERSION@
%define rel     0
%define prefix  /usr
%define name    @PACKAGE@
%define ginstall @INSTALL@

Name:        %{name}
Summary:     A Free Video Player.
Summary(ko): °ø°³ µ¿¿µ»ó ÇÃ·¹ÀÌ¾î
Version:     %{ver}
Release:     %{rel}
Copyright:   GPL
Group:       Applications/Multimedia
Source:      http://xine.sourceforge.net/files/@PACKAGE@-@VERSION@.tar.gz
URL:         http://xine.sourceforge.net
Packager:    Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
Requires:    xine-lib >= %{ver}
BuildRoot:   /tmp/%{name}-root

@HAVE_AA_TRUE@%package aa
@HAVE_AA_TRUE@Summary:     XINE - Ascii Art player.
@HAVE_AA_TRUE@Group:       Applications/Multimedia
@HAVE_AA_TRUE@Requires:    xine-lib >= %{ver}, xine-lib-aa

%description
xine is a free gpl-licensed video player for unix-like systems.
We support mpeg-2 and mpeg-1 system (audio + video multiplexed) streams,
eventually mpeg-4 and other formats might be added.

xine plays the video and audio data of mpeg-2 videos and synchronizes
the playback of both. Depending on the properties of the mpeg stream,
playback will need more or less processor power, 100% frame rate
has been seen on a 400 MHz P II system.

%description -l fr
xine est un lecteur vidéo libre sous license GPL pour les systèmes de
type unix. Nous supportons les flux mpeg-2 et mpeg-1 (audio + vidéo 
multiplexés), éventuellement le mpeg-4 et d'autres formats peuvent
êtres ajoutés.

xine joue les données vidéo et audio de vidéo mpeg-2 et synchronise
la lecture des deux. En fonction des propriétes du flux mpeg,
la lecture aura besoin de plus ou moins de puissance du processeur, 
100% de restitution de trame a été vus sur un système PII 400MHz.

%description -l ko
xine ´Â GPL¶óÀÌ¼±½º¸¦ µû¸£´Â UNIX¿ë °ø°³ µ¿¿µ»ó ÇÃ·¹ÀÌ¾îÀÔ´Ï´Ù. ÀÌ
ÇÃ·¹ÀÌ¾î´Â mpeg-2 ¿Í mpeg 1 ½ºÆ®¸²À» Áö¿øÇÏ¸ç, ÇöÀç´Â Áö¿øÇÏÁö
¾ÊÁö¸¸ ³ªÁß¿¡´Â mpeg-4 ¿Í ´Ù¸¥ Çü½ÄÀÇ µ¿¿µ»óµµ Áö¿øÇÒ ¿¹Á¤ÀÔ´Ï´Ù.

%description -l pt
O xine é um leitor de vídeo livre ao abrigo da GPL para sistemas tipo
Unix. Lê ficheiros MPEG-2 e MPEG-1, bem como AVIs que contenham
MS MPEG-4 / OpenDivX Video.

O xine lê o conteúdo vídeo e áudio e sincroniza-os em tempo-real. As
necessidades de processador dependem das propriedades de cada ficheiro.
Em princípio, um sistema equipado com um Pentium-II a 400 MHz consegue
ler qualquer vídeo com máximo desempenho.

@HAVE_AA_TRUE@%description aa
@HAVE_AA_TRUE@Video player using Ascii Art library.

%prep
%setup -n @TAR_NAME@

%build
./configure --prefix=%{prefix}
make

%install
if [ -d $RPM_BUILD_ROOT ]; then rm -rf $RPM_BUILD_ROOT; fi
#mkdir -p $RPM_BUILD_ROOT/usr/include/X11/pixmaps
make install-strip DESTDIR=$RPM_BUILD_ROOT
#cp doc/*.xpm $RPM_BUILD_ROOT/usr/include/X11/pixmaps

%post
#/sbin/ldconfig
if test -d @XINE_SKINDIR@/metal; then rm -rf @XINE_SKINDIR@/metal; fi
if test -d @XINE_SKINDIR@/default; then rm -rf @XINE_SKINDIR@/default && ln -s @XINE_SKINDIR@/xinetic @XINE_SKINDIR@/default; fi
# Icons
if test ! -d /usr/share/icons; then 
  %{ginstall} -m 755 -o 0 -g 0 -d /usr/share/icons
fi
%{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.xpm /usr/share/icons/xine.xpm
if test ! -d /usr/share/pixmaps; then 
  %{ginstall} -m 755 -o 0 -g 0 -d /usr/share/pixmaps
fi
%{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.xpm /usr/share/pixmaps/xine.xpm
if test -d /etc/X11/wmconfig; then 
  %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.wmconfig /etc/X11/wmconfig/xine
fi
if test -d /etc/X11/applnk; then
  if test ! -d /etc/X11/applnk/Multimedia; then 
    %{ginstall} -m 755 -o 0 -g 0 -d /etc/X11/applnk/Multimedia
  fi
  %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.desktop /etc/X11/applnk/Multimedia/xine.desktop
fi
# End Icons
# Gnome
if test -d /opt/gnome; then
  if test ! -d /opt/gnome/share/pixmaps; then 
    %{ginstall} -m 755 -o 0 -g 0 -d /opt/gnome/share/pixmaps
  fi
  %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.xpm /opt/gnome/share/pixmaps/xine.xpm
  if test -d /opt/gnome/share/gnome/apps/Multimedia; then
    %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.desktop /opt/gnome/share/gnome/apps/Multimedia/xine.desktop
  else
    %{ginstall} -m 755 -o 0 -g 0 -d /opt/gnome/share/gnome/apps/Multimedia
    %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.desktop /opt/gnome/share/gnome/apps/Multimedia/xine.desktop
  fi
else
  if test -d /usr/share/gnome/apps; then
    if test -d /usr/share/gnome/apps/Multimedia; then
      %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.desktop /usr/share/gnome/apps/Multimedia/xine.desktop
    else
      %{ginstall} -m 755 -o 0 -g 0 -d /usr/share/gnome/apps/Multimedia
      %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.desktop /usr/share/gnome/apps/Multimedia/xine.desktop
    fi
  fi
fi
# End Gnome
# Kde2
if test -d /opt/kde2/; then
  DIR_HI=/opt/kde2/share/icons/hicolor
  DIR_LO=/opt/kde2/share/icons/locolor
  HIRES='48x48 32x32 22x22'
  LORES='32x32 22x22 16x16'
  for hires in $$HIRES; do
    %{ginstall} -m 755 -o 0 -g 0 -d $DIR_HI/$hires/apps
    %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine_$hires.png $DIR_HI/$hires/apps/xine.png
  done
  for lores in $$LORES; do
    %{ginstall} -m 755 -o 0 -g 0 -d $DIR_LO/$lores/apps
    %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine_$lores.png $DIR_LO/$lores/apps/xine.png
  done
  if test ! -d /opt/kde2/share/applnk/Multimedia; then 
    %{ginstall} -m 755 -o 0 -g 0 -d /opt/kde2/share/applnk/Multimedia
  fi
  %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.desktop /opt/kde2/share/applnk/Multimedia/xine.desktop
else
  if test -d /usr/share/applnk/Multimedia; then
    if test ! -d /usr/share/applnk/Multimedia; then 
      %{ginstall} -m 755 -o 0 -g 0 -d /usr/share/applnk/Multimedia
    fi
    %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.desktop /usr/share/applnk/Multimedia/xine.desktop
  fi
fi
# End Kde2
# Kde
if test -d /opt/kde; then
  if test ! -d /opt/kde/share/icons; then 
    %{ginstall} -m 755 -o 0 -g 0 -d /opt/kde/share/icons
  fi
  if test ! -d /opt/kde/share/applnk/Multimedia; then 
    %{ginstall} -m 755 -o 0 -g 0 -d /opt/kde/share/applnk/Multimedia
  fi
  %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.xpm /opt/kde/share/icons/xine.xpm
  %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.desktop /opt/kde/share/applnk/Multimedia/xine.desktop
else
  if test -d /usr/share/applnk/Multimedia; then 
    %{ginstall} -m 644 -o 0 -g 0 @XINE_DESKTOPDIR@/xine.desktop /usr/share/applnk/Multimedia/xine.desktop
  fi
fi
# End Kde

%preun
  REMOVALS='/usr/share/icons/xine.xpm /usr/share/pixmaps/xine.xpm /etc/X11/wmconfig/xine /etc/X11/applnk/Multimedia/xine.desktop /opt/gnome/share/pixmaps/xine.xpm /opt/gnome/share/gnome/apps/Multimedia/xine.desktop /usr/share/gnome/apps/Multimedia/xine.desktop /opt/kde2/share/applnk/Multimedia/xine.desktop /usr/share/applnk/Multimedia/xine.desktop /opt/kde/share/icons/xine.xpm /opt/kde/share/applnk/Multimedia/xine.desktop /usr/share/applnk/Multimedia/xine.desktop'
  for remove in $REMOVALS; do
    rm -f $remove
  done
  HIRES='48x48 32x32 22x22'
  LORES='32x32 22x22 16x16'
  for hires in $HIRES; do
    rm -f $DIR_HI/$hires/apps/xine.png
  done
  for lores in $LORES; do
    rm -f $DIR_LO/$lores/apps/xine.png
  done

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
# binaries
%{prefix}/bin/xine
%{prefix}/share/idl/xine.idl
# skins
@XINE_SKINDIR@/lcd/*
@XINE_SKINDIR@/pitt/*
@XINE_SKINDIR@/xinetic/*
@XINE_SKINDIR@/cloudy/*
# misc script
@XINE_SCRIPTDIR@/xineshot
# desktop entries/icons
@XINE_DESKTOPDIR@/*
# documentation
%{prefix}/man/fr/man1/xine.1*
%{prefix}/man/es/man1/xine.1*
%{prefix}/man/pl/man1/xine.1*
%{prefix}/man/man1/xine.1*
%{prefix}/share/doc/xine-ui/FAQ_en
%{prefix}/share/doc/xine-ui/FAQ_es
%{prefix}/share/doc/xine-ui/FAQ_fr
%{prefix}/share/doc/xine-ui/FAQ_it
%{prefix}/share/doc/xine-ui/FAQ_pl
%{prefix}/share/doc/xine-ui/README.corba
%{prefix}/share/doc/xine-ui/README.divx4
%{prefix}/share/doc/xine-ui/README.dxr3
%{prefix}/share/doc/xine-ui/README.dxr3_pl
%{prefix}/share/doc/xine-ui/README.freebsd
%{prefix}/share/doc/xine-ui/README.irix
%{prefix}/share/doc/xine-ui/README.mrl
%{prefix}/share/doc/xine-ui/README.solaris
%{prefix}/share/doc/xine-ui/README.syncfb
%{prefix}/share/doc/xine-ui/README.config_en
%{prefix}/share/doc/xine-ui/README_en
%{prefix}/share/doc/xine-ui/README_es
%{prefix}/share/doc/xine-ui/README_pl
%{prefix}/share/doc/xine-ui/README_it
%{prefix}/share/doc/xine-ui/bug_report_form
## intl files
%{prefix}/share/locale/fr/LC_MESSAGES/xine-ui.mo
%{prefix}/share/locale/fr/LC_MESSAGES/xitk.mo
%{prefix}/share/locale/es/LC_MESSAGES/xine-ui.mo
%{prefix}/share/locale/es/LC_MESSAGES/xitk.mo
%{prefix}/share/locale/pt_BR/LC_MESSAGES/xine-ui.mo
%{prefix}/share/locale/pt_BR/LC_MESSAGES/xitk.mo

@HAVE_AA_TRUE@%files aa
@HAVE_AA_TRUE@%defattr(-,root,root)
@HAVE_AA_TRUE@%{prefix}/bin/aaxine
@HAVE_AA_TRUE@%{prefix}/man/man1/aaxine.1*
@HAVE_AA_TRUE@%{prefix}/man/pl/man1/aaxine.1*

%changelog
* Fri Dec 14 2001 Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
- Add portuguese brazilian *.mo files: thanks to Miguel Freitas <miguel@cetuc.puc-rio.br> ;-)
* Tue Nov 27 2001 Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
- Add spanish *.mo files: thanks to Juan Manuel García Molina <juanmagm@mail.com>
* Sun Nov 18 2001 Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
- Add *.mo files
* Wed Oct 3 2001 Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
- use DESTDIR for package building and add xineshot, based on patch from Andrew Meredith <andrew@anvil.org>
* Thu Sep 27 2001 Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
- Add icons and desktop stuff from patches by Miguel Freitas <miguel@cetuc.puc-rio.br>
* Sun Sep 16 2001 Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
- Merge patch from José Carlos Monteiro <jcm@netcabo.pt>:
  - Filelist and other minor updates,
  - Fixed some SuSE compatibility issues,
  - Added Portuguese summary.
* Sun Sep 16 2001 Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
- Add missing files.
* Thu Jul 26 2001 Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
- Made AA as separate package.
* Thu Jul 26 2001 Matthias Dahl <matthew2k@web.de>
- updated filelist.
* Tue Jul 03 2001 Matthias Dahl <matthew2k@web.de>
- fixed the "no-skins-in-final-RPM-package" problem (nice explanation *grin*)
* Sun Jun 10 2001 Matthias Dahl <matthew2k@web.de>
- updated filelist and the requirements field
- removed /sbin/ldconfig as post install script
* Thu Mar 28 2001 Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
- add korean summary, patch from Louis JANG <louis@ns.mizi.com>
* Thu Jan 11 2001 Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
- patch from Sung-Hyun Nam <namsh@lgic.co.kr> applied.
* Fri Oct 17 2000 Daniel Caujolle-Bert <f1rmb@users.sourceforge.net>
- first spec file.
